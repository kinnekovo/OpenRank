version: '3.8'

services:
  clickhouse:
    image: clickhouse/clickhouse-server:latest
    container_name: openrank-clickhouse
    restart: unless-stopped
    ports:
      - "9000:9000"
      - "8123:8123"
      - "9009:9009"
    environment:
      - CLICKHOUSE_DB=openrank
      - CLICKHOUSE_USER=default
      - CLICKHOUSE_PASSWORD=
    volumes:
      - ./data/clickhouse:/var/lib/clickhouse
      - ./docker/clickhouse/init:/docker-entrypoint-initdb.d
    ulimits:
      nofile:
        soft: 262144
        hard: 262144

  dataease:
    image: dataease/dataease:latest
    container_name: openrank-dataease
    restart: unless-stopped
    ports:
      - "8080:8081"
    environment:
      - MYSQL_HOST=mysql
      - MYSQL_PORT=3306
      - MYSQL_USER=dataease
      - MYSQL_PASSWORD=DataEase@2022
      - MYSQL_DB=dataease
    depends_on:
      - mysql
    volumes:
      - ./data/dataease:/opt/dataease/data
      - /var/run/docker.sock:/var/run/docker.sock

  mysql:
    image: mysql:8.0
    container_name: openrank-mysql
    restart: unless-stopped
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=DataEase@2022
      - MYSQL_DATABASE=dataease
      - MYSQL_USER=dataease
      - MYSQL_PASSWORD=DataEase@2022
    volumes:
      - ./data/mysql:/var/lib/mysql

volumes:
  clickhouse-data:
  dataease-data:
  mysql-data: